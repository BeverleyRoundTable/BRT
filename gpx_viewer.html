<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GPX Route Viewer</title>

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #111;
  }
  #map {
    width: 100%;
    height: 100%;
  }
</style>
</head>

<body>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet GPX plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>

<script>
(function () {

  function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  // NEW: support full GPX URLs OR filename-based GPX
  const fullUrl = getQueryParam("gpx");
  const fileName = getQueryParam("file");

  let gpxUrl = "";

  if (fullUrl) {
    // Use full URL from Carrd sheet
    gpxUrl = fullUrl;
  } else if (fileName) {
    // Fallback: load from GitHub GPX folder
    gpxUrl =
      "https://raw.githubusercontent.com/BeverleyRoundTable/BRT/main/GPX/" +
      fileName;
  } else {
    alert("No GPX file provided.\n\nUse either ?gpx=fullURL or ?file=filename.gpx");
    return;
  }

  const map = L.map("map");
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
  }).addTo(map);

  const gpx = new L.GPX(gpxUrl, {
    async: true,
    marker_options: {
      startIconUrl:
        "https://unpkg.com/leaflet-gpx@1.7.0/pin-icon-start.png",
      endIconUrl:
        "https://unpkg.com/leaflet-gpx@1.7.0/pin-icon-end.png",
      shadowUrl:
        "https://unpkg.com/leaflet-gpx@1.7.0/pin-shadow.png",
    },
  })
    .on("loaded", function (e) {
      map.fitBounds(e.target.getBounds());
    })
    .addTo(map);

})();
</script>

</body>
</html>
