<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snowman Maker</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#0b1d3a;
  color:#fff;
}
.wrapper{
  max-width:980px;
  margin:auto;
  padding:20px;
}
h1{
  text-align:center;
  margin-bottom:20px;
}
.group{
  background:#ffffff12;
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
}
.group h3{
  margin:0 0 10px 0;
  font-size:16px;
}
.options{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.options button{
  background:#e8edff;
  color:#000;
  border:none;
  padding:8px 14px;
  border-radius:999px;
  font-weight:600;
  cursor:pointer;
}
.options button.active{
  background:#3b82f6;
  color:#fff;
}
.builder{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  align-items:center;
}
canvas{
  display:block;
  margin:auto;
}
.download{
  text-align:center;
  margin-top:20px;
}
.download button{
  background:#b01d23;
  color:#fff;
  border:none;
  padding:14px 22px;
  border-radius:999px;
  font-size:16px;
  cursor:pointer;
}
@media(max-width:800px){
  .builder{ grid-template-columns:1fr; }
}

  body.embed .wrapper {
  max-width: 420px;
}

body.embed .builder {
  grid-template-columns: 1fr;
}

</style>
</head>

<body>
<div class="wrapper">
<h1>‚òÉÔ∏è Build Your Snowman</h1>

<div class="builder">
<div>

<div class="group">
<h3>üé© Hat</h3>
<div class="options" data-key="hat">
<button class="active" data-value="top">Top Hat</button>
<button data-value="beanie">Beanie</button>
<button data-value="santa">Santa Hat</button>
<button data-value="none">None</button>
</div>
</div>

<div class="group">
<h3>üëÄ Eyes</h3>
<div class="options" data-key="eyes">
<button class="active" data-value="coal">Coal</button>
<button data-value="hearts">‚ù§Ô∏è Hearts</button>
<button data-value="stars">‚≠ê Stars</button>
</div>
</div>

<div class="group">
<h3>ü•ï Nose</h3>
<div class="options" data-key="nose">
<button class="active" data-value="carrot">Carrot</button>
<button data-value="candy">üç¨ Sweet</button>
<button data-value="button">üî¥ Button</button>
</div>
</div>

<div class="group">
<h3>üß£ Scarf</h3>
<div class="options" data-key="scarf">
<button class="active" data-value="red">Red</button>
<button data-value="blue">Blue</button>
<button data-value="green">Green</button>
<button data-value="purple">Purple</button>
</div>
</div>

<div class="group">
<h3>üéΩ Body</h3>
<div class="options" data-key="body">
<button class="active" data-value="buttons">Buttons</button>
<button data-value="jumper">Jumper</button>
<button data-value="badge">Badge</button>
<button data-value="none">None</button>
</div>
</div>

<div class="group">
<h3>üß§ Hands</h3>
<div class="options" data-key="hands">
<button class="active" data-value="none">None</button>
<button data-value="mittens">Mittens</button>
<button data-value="present">üéÅ Present</button>
<button data-value="broom">üßπ Broom</button>
</div>
</div>

</div>

<canvas id="canvas" width="600" height="800"></canvas>
</div>

<div class="download">
  <br><br>
  <button onclick="goToFrame()">‚û°Ô∏è Step 2: Add your face</button>
</div>

</div>

<script>
  const isEmbedded = window.self !== window.top;
if (isEmbedded) {
  document.body.classList.add("embed");
}

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const snowman = {
  hat:"top", eyes:"coal", nose:"carrot", scarf:"red",
  body:"buttons", hands:"none"
};

const HEAD_Y=200, EYE_Y=175, L=270, R=330;

document.querySelectorAll(".options button").forEach(btn=>{
  btn.onclick=()=>{
    const k=btn.parentElement.dataset.key;
    snowman[k]=btn.dataset.value;
    btn.parentElement.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    draw();
  };
});

function draw(){
ctx.clearRect(0,0,600,800);

// body
ball(300,560,140); ball(300,360,110); ball(300,HEAD_Y,90);
arms(); bodyAccessory(); handAccessory();

// face
if(snowman.eyes==="coal"){ eye(L,EYE_Y); eye(R,EYE_Y); }
else{ emoji(snowman.eyes==="hearts"?"‚ù§Ô∏è":"‚≠ê",L-12,EYE_Y+12); emoji(snowman.eyes==="hearts"?"‚ù§Ô∏è":"‚≠ê",R-12,EYE_Y+12); }

snowman.nose==="carrot"?carrot():emoji(snowman.nose==="candy"?"üç¨":"üî¥",288,215);

// scarf
ctx.fillStyle={red:"#b01d23",blue:"#2563eb",green:"#16a34a",purple:"#7c3aed"}[snowman.scarf];
ctx.fillRect(190,260,220,28);

// hat
if(snowman.hat==="top") topHat();
if(snowman.hat==="beanie") beanie();
if(snowman.hat==="santa") santaHat();
  sendHeight(20);
}

function ball(x,y,r){ ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle="#fff"; ctx.fill(); }
function eye(x,y){ ctx.beginPath(); ctx.arc(x,y,6,0,Math.PI*2); ctx.fillStyle="#000"; ctx.fill(); }
function emoji(t,x,y){ ctx.font="32px system-ui"; ctx.fillText(t,x,y); }

function carrot(){ ctx.fillStyle="#ff7a00"; ctx.beginPath(); ctx.moveTo(300,HEAD_Y); ctx.lineTo(340,HEAD_Y+8); ctx.lineTo(300,HEAD_Y+16); ctx.fill(); }

function topHat(){ ctx.fillStyle="#000"; ctx.fillRect(240,60,120,70); ctx.fillRect(220,130,160,12); }
function beanie(){ ctx.fillStyle="#3b82f6"; ctx.beginPath(); ctx.arc(300,110,60,Math.PI,0); ctx.fill(); }
function santaHat(){
ctx.fillStyle="#b01d23";
ctx.beginPath(); ctx.moveTo(220,120); ctx.quadraticCurveTo(300,40,380,120); ctx.fill();
ctx.fillStyle="#fff"; ctx.fillRect(220,120,160,16);
ctx.beginPath(); ctx.arc(380,120,10,0,Math.PI*2); ctx.fill();
}

function arms(){
ctx.strokeStyle="#5b3a1e"; ctx.lineWidth=6;
ctx.beginPath(); ctx.moveTo(180,320); ctx.lineTo(120,280); ctx.stroke();
ctx.beginPath(); ctx.moveTo(420,320); ctx.lineTo(480,280); ctx.stroke();
}

function bodyAccessory(){
  if(snowman.body==="buttons"){
    dot(300,300);
    dot(300,340);
    dot(300,380);
  }

  if(snowman.body==="jumper"){
    jumper();
  }

  if(snowman.body==="badge"){
    ctx.fillStyle="#facc15";
    ctx.beginPath();
    ctx.arc(330,320,14,0,Math.PI*2);
    ctx.fill();
  }
}

  function jumper(){
  const cx = 300;
  const cy = 360;
  const r  = 110;

  ctx.save();

  // clip strictly to middle snowball
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.clip();

  // === base fill ===
  ctx.fillStyle = "#2563eb";
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.fill();

  // === lighter horizontal stripe ===
  ctx.fillStyle = "#3b82f6";
  ctx.beginPath();
  ctx.ellipse(cx, cy - 5, r, 26, 0, 0, Math.PI * 2);
  ctx.fill();

  // === darker lower shading ===
  ctx.fillStyle = "#1e40af";
  ctx.beginPath();
  ctx.ellipse(cx, cy + 30, r, 30, 0, 0, Math.PI * 2);
  ctx.fill();

  // === knit texture ===
  ctx.fillStyle = "rgba(255,255,255,0.15)";
  for(let y = cy - r + 14; y < cy + r; y += 14){
    for(let x = cx - r + 14; x < cx + r; x += 14){
      if(Math.hypot(x - cx, y - cy) < r - 6){
        ctx.beginPath();
        ctx.arc(x + (y % 8), y, 1.2, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }

  ctx.restore();
}

function handAccessory(){
if(snowman.hands==="mittens"){ mitten(120,280); mitten(480,280); }
if(snowman.hands==="present"){ ctx.fillStyle="#16a34a"; ctx.fillRect(460,260,30,30); ctx.strokeStyle="#fff"; ctx.strokeRect(460,260,30,30); }
if(snowman.hands==="broom"){
ctx.strokeStyle="#8b5a2b"; ctx.lineWidth=6;
ctx.beginPath(); ctx.moveTo(120,280); ctx.lineTo(120,220); ctx.stroke();
ctx.fillStyle="#facc15"; ctx.fillRect(110,210,20,12);
}
}

function dot(x,y){ ctx.beginPath(); ctx.arc(x,y,6,0,Math.PI*2); ctx.fillStyle="#000"; ctx.fill(); }
function mitten(x,y){ ctx.beginPath(); ctx.arc(x,y,14,0,Math.PI*2); ctx.fillStyle="#b01d23"; ctx.fill(); }

function downloadPNG(){
const a=document.createElement("a");
a.download="my-snowman.png";
a.href=canvas.toDataURL("image/png");
a.click();
}

  function goToFrame(){
  // export the snowman canvas as transparent PNG
  const png = canvas.toDataURL("image/png");

  // store in localStorage for the next page
  localStorage.setItem("snowmanPNG", png);

  // go to the frame page (same tab is IMPORTANT)
  window.location.href = "snowman_frame.html";
}

draw();
  
</script>

  <script>
function sendHeight(extra = 20) {
  const wrapper = document.querySelector(".wrapper");
  if (!wrapper) return;

  const rect = wrapper.getBoundingClientRect();
  const height = Math.ceil(rect.height) + extra;

  parent.postMessage({ snowmanFrameHeight: height }, "*");
}

// initial load
window.addEventListener("load", () => sendHeight());

// resize (desktop + mobile)
window.addEventListener("resize", () => sendHeight());

</script>
  
</body>
</html>
